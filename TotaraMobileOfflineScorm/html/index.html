<!--
 * This file is part of Totara Mobile
 *
 * Copyright (C) 2019 onwards Totara Learning Solutions LTD
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 * @author: Kamala Tennakoon <kamala.tennakoon@totaralearning.com>
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="author" content="Kamala Tennakoon <kamala.tennakoon@totaralearning.com>" />
  <meta name="viewport" content="width=device-width, initial-scale=0.8, minimal-ui" />
  <title>Totara Mobile SCORM 1.2</title>
  <script type="text/javascript">
    var API = null;
    const onInjectScormData = (_entrysrc, _def, _cmiobj, _cmiint, _scormdebugging, _scormauto, _scormid, _scoid, _attempt, _autocommit, _masteryoverride, _hidetoc, oldcmi) => {
      def = JSON.parse(_def);
      cmiobj = JSON.parse(_cmiobj);
      cmiint = JSON.parse(_cmiint);
      scormdebugging = _scormdebugging;
      scormauto = _scormauto;
      scormid = _scormid;
      scoid = _scoid;
      attempt = _attempt;
      autocommit = _autocommit;
      masteryoverride = _masteryoverride;
      hidetoc = _hidetoc;

      
      API = new SCORMapi1_2(
        def,
        cmiobj,
        cmiint,
        scormdebugging,
        scormauto,
        scormid,
        scoid,
        attempt,
        autocommit,
        masteryoverride,
        hidetoc,
        oldcmi
      );
     document.getElementById('scorm_object').setAttribute('src', _entrysrc);
    };
    const LogAPICall = (...arguments) => {
      var data = '';
      for (var i = 0; i < arguments.length; i++) {
        data = data === '' ? arguments[i] : data + ', ' + arguments[i];
      }
      if (document.getElementById('outputContainer')) {
        var loggerWindow = document.getElementById('outputContainer');
        var item = document.createElement('div');
        if (typeof data === 'string') {
          item.innerText = data;
        } else {
          item.innerText = JSON.stringify(data);
        }
        loggerWindow.appendChild(item);
      } 
    };
    const onpostCommitDataToNative = (scormid, scoid, attempt, commit, cmi) => {
      console.log('commitScormData commit:> ', commit, 'cmi:', cmi);
      var scormData = {
        scormid: scormid,
        attempt: attempt,
        scoid: scoid,
        commit: commit,
        cmi: cmi
      }
      const postData = { tmsevent: "SCORMCOMMIT", result: scormData }
      if (window.ReactNativeWebView !== undefined) {
        window.ReactNativeWebView.postMessage(JSON.stringify(postData));
      }
    };
  </script>
</head>

<body style="margin: 0; padding: 0;height: 100%;width: 100%;">
  <div id="scorm_object_container" style="height: 100%; width: 100%; overflow: scroll; display: block;">
    <iframe id="scorm_object" allowfullscreen="allowfullscreen" webkitallowfullscreen="webkitallowfullscreen" mozallowfullscreen="mozallowfullscreen" height="100%" width="100%" src="loading_scorm.html"></iframe>
  </div>
  <!-- 
  <p>
    <button type="button" onclick="document.getElementById('outputContainer').innerHTML='';">Clear Log</button>
  </p>
  <div id="outputContainer" style="width: 100%; background: #cecece; height: 20px; overflow: scroll;"></div> 
  -->
  <script src="scorm_12.js"></script>
</body>
</html>
